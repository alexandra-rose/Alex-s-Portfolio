<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>final assignment, Alexandra Salo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="finalassignment_files/libs/clipboard/clipboard.min.js"></script>
<script src="finalassignment_files/libs/quarto-html/quarto.js"></script>
<script src="finalassignment_files/libs/quarto-html/popper.min.js"></script>
<script src="finalassignment_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="finalassignment_files/libs/quarto-html/anchor.min.js"></script>
<link href="finalassignment_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="finalassignment_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="finalassignment_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="finalassignment_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="finalassignment_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">final assignment, Alexandra Salo</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="libraries-and-cleaning-the-data" class="level2">
<h2 class="anchored" data-anchor-id="libraries-and-cleaning-the-data">Libraries and cleaning the data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ lubridate 1.9.2     ✔ tibble    3.2.1
✔ purrr     1.0.2     ✔ tidyr     1.3.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
✖ purrr::lift()   masks caret::lift()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wbstats)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'

The following object is masked from 'package:ggplot2':

    last_plot

The following object is masked from 'package:stats':

    filter

The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DataExplorer) </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(writexl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'writexl' was built under R version 4.3.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjlabelled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'sjlabelled'

The following objects are masked from 'package:haven':

    as_factor, read_sas, read_spss, read_stata, write_sas, zap_labels

The following object is masked from 'package:forcats':

    as_factor

The following object is masked from 'package:dplyr':

    as_label

The following object is masked from 'package:ggplot2':

    as_label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'scales'

The following object is masked from 'package:purrr':

    discard

The following object is masked from 'package:readr':

    col_factor</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'rnaturalearthdata' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rnaturalearthdata'

The following object is masked from 'package:rnaturalearth':

    countries110</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'

The following object is masked from 'package:plotly':

    select

The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData

Attaching package: 'car'

The following object is masked from 'package:dplyr':

    recode

The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.

Attaching package: 'pROC'

The following object is masked from 'package:gmodels':

    ci

The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pdp'

The following object is masked from 'package:purrr':

    partial</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(utils)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read the data, I chose a dataset that we had used in a course last year about job satisfaction and other variables describing the nature of the employment of a person.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"jobsatisf.csv"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">delim =</span> <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 6400 Columns: 30
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr  (1): gender
dbl (28): age, marital, address, income, inccat, carcat, ed, employ, retire,...
num  (1): car

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,400 × 30
     age marital address income inccat   car carcat    ed employ retire empcat
   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1    55       1      12     72      3   362      3     1     23      0      3
 2    56       0      29    153      4   769      3     1     35      0      3
 3    28       1       9     28      2   137      1     3      4      0      1
 4    24       1       4     26      2   125      1     4      0      0      1
 5    25       0       2     23      1   113      1     2      5      0      2
 6    45       1       9     76      4   372      3     3     13      0      2
 7    42       0      19     40      2   198      2     3     10      0      2
 8    35       0      15     57      3   282      2     2      1      0      1
 9    46       0      26     24      1   122      1     1     11      0      2
10    34       1       0     89      4   461      3     3     12      0      2
# ℹ 6,390 more rows
# ℹ 19 more variables: jobsat &lt;dbl&gt;, gender &lt;chr&gt;, reside &lt;dbl&gt;,
#   wireless &lt;dbl&gt;, multline &lt;dbl&gt;, voice &lt;dbl&gt;, pager &lt;dbl&gt;, internet &lt;dbl&gt;,
#   callid &lt;dbl&gt;, callwait &lt;dbl&gt;, owntv &lt;dbl&gt;, ownvcr &lt;dbl&gt;, owncd &lt;dbl&gt;,
#   ownpda &lt;dbl&gt;, ownpc &lt;dbl&gt;, ownfax &lt;dbl&gt;, news &lt;dbl&gt;, response &lt;dbl&gt;,
#   `filter_$` &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#reduce dataset to </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)  <span class="co"># Total number of observations</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fl">0.6</span> <span class="sc">*</span> n)  <span class="co"># Number of observations to keep (5% of total)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select the indices of the observations to keep</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>indices_to_keep <span class="ot">&lt;-</span> <span class="fu">sample</span>(n, sample_size)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the dataset to keep only the selected observations</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> data[indices_to_keep, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the class of all variables in your dataset</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>variable_classes <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data1, class)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(variable_classes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        age     marital     address      income      inccat         car 
  "numeric"   "numeric"   "numeric"   "numeric"   "numeric"   "numeric" 
     carcat          ed      employ      retire      empcat      jobsat 
  "numeric"   "numeric"   "numeric"   "numeric"   "numeric"   "numeric" 
     gender      reside    wireless    multline       voice       pager 
"character"   "numeric"   "numeric"   "numeric"   "numeric"   "numeric" 
   internet      callid    callwait       owntv      ownvcr       owncd 
  "numeric"   "numeric"   "numeric"   "numeric"   "numeric"   "numeric" 
     ownpda       ownpc      ownfax        news    response    filter_$ 
  "numeric"   "numeric"   "numeric"   "numeric"   "numeric"   "numeric" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values in your dataset</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>missing_values <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(data1))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     age  marital  address   income   inccat      car   carcat       ed 
       0        0        0        0        0        0        0        0 
  employ   retire   empcat   jobsat   gender   reside wireless multline 
       0        0        0        0        0        0        0        0 
   voice    pager internet   callid callwait    owntv   ownvcr    owncd 
       0        0        0        0        0        0        0        0 
  ownpda    ownpc   ownfax     news response filter_$ 
       0        0        0        0        0        0 </code></pre>
</div>
</div>
<p>Here we check for the classes of each variable and missing data. We have no missing data in any of the variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorr</span>(data1, <span class="at">label =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ggcorr(data1, label = T): data in column(s) 'gender' are not numeric
and were ignored</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_report</span>(data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>

processing file: report.rmd</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>1/42                                 
2/42 [global_options]                
3/42                                 
4/42 [introduce]                     
5/42                                 
6/42 [plot_intro]                    </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>7/42                                 
8/42 [data_structure]                
9/42                                 
10/42 [missing_profile]               </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>11/42                                 
12/42 [univariate_distribution_header]
13/42                                 
14/42 [plot_histogram]                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>15/42                                 
16/42 [plot_density]                  
17/42                                 
18/42 [plot_frequency_bar]            </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>19/42                                 
20/42 [plot_response_bar]             
21/42                                 
22/42 [plot_with_bar]                 
23/42                                 
24/42 [plot_normal_qq]                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>25/42                                 
26/42 [plot_response_qq]              
27/42                                 
28/42 [plot_by_qq]                    
29/42                                 
30/42 [correlation_analysis]          </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>31/42                                 
32/42 [principal_component_analysis]  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>33/42                                 
34/42 [bivariate_distribution_header] 
35/42                                 
36/42 [plot_response_boxplot]         
37/42                                 
38/42 [plot_by_boxplot]               
39/42                                 
40/42 [plot_response_scatterplot]     
41/42                                 
42/42 [plot_by_scatterplot]           </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>output file: /Users/alexandrasalo/Desktop/Advanced Modeling/final assignment/report.knit.md</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>/Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/pandoc +RTS -K512m -RTS '/Users/alexandrasalo/Desktop/Advanced Modeling/final assignment/report.knit.md' --to html4 --from markdown+autolink_bare_uris+tex_math_single_backslash --output pandoc13ec44308b6c5.html --lua-filter /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library/rmarkdown/rmarkdown/lua/pagebreak.lua --lua-filter /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library/rmarkdown/rmarkdown/lua/latex-div.lua --embed-resources --standalone --variable bs3=TRUE --section-divs --table-of-contents --toc-depth 6 --template /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library/rmarkdown/rmd/h/default.html --no-highlight --variable highlightjs=1 --variable theme=yeti --mathjax --variable 'mathjax-url=https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' --include-in-header /var/folders/8y/722shxnx3sj3sw4sdp_w7z400000gn/T//RtmpUWnY1D/rmarkdown-str13ec4328afd7f.html </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Output created: report.html</code></pre>
</div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for variables with only one level</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>one_level_variables <span class="ot">&lt;-</span> <span class="fu">sapply</span>(data1, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(one_level_variables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     age  marital  address   income   inccat      car   carcat       ed 
   FALSE    FALSE    FALSE    FALSE    FALSE    FALSE    FALSE    FALSE 
  employ   retire   empcat   jobsat   gender   reside wireless multline 
   FALSE    FALSE    FALSE    FALSE    FALSE    FALSE    FALSE    FALSE 
   voice    pager internet   callid callwait    owntv   ownvcr    owncd 
   FALSE    FALSE    FALSE    FALSE    FALSE    FALSE    FALSE    FALSE 
  ownpda    ownpc   ownfax     news response filter_$ 
   FALSE    FALSE    FALSE    FALSE    FALSE    FALSE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove variables with only one level/ no variation</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> data1 <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(<span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we do a descriptive analysis of the dataset, first we check for multicolinearity. We see some colinearity in the dataset generally, and some with the dependent variable jobsatisfaction (jobsat). I also see quite a bit of collinearity in the bottom left corner indicating we may have some multicollinearity between the income and car variables. This makes sense however as they give a lot of the same information, eg. income and income category, car price and car price category. I choose to take out the categorical variables for the car price and income.</p>
<p>Otherwise in the descriptive analysis we don’t see a lot of clear outliers or causes for concern. Most variables are not specifically normally distributed. Interestingly we have a very strong peak for the income variable, which gets me interested in this variable and to see how the extremes of this variable affect the target variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove uninteresting variables</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(data1, <span class="sc">-</span>inccat, <span class="sc">-</span>carcat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predictions-using-classification-models" class="level2">
<h2 class="anchored" data-anchor-id="predictions-using-classification-models">Predictions using classification models</h2>
<p>Applying classification algorithms (e.g., logistic regression, decision trees) to predict being very satisfied in your job.</p>
<ul>
<li>Emphasize interpretation by explaining the relationships between predictors and high job satisfaction.</li>
</ul>
<p>First we need to define success, in this case satisfaction with work! On a scale from 1-5 we will count 5 as the success. So we will be predicting if job satisfaction == 5, so if a person will have high job satisfaction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>Satisfied <span class="ot">=</span> <span class="fu">factor</span>(data1<span class="sc">$</span>jobsat<span class="sc">&gt;</span><span class="dv">4</span>) </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>data1<span class="sc">$</span>jobsat <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(<span class="fu">table</span>(data1<span class="sc">$</span>Satisfied))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    FALSE      TRUE 
0.8078125 0.1921875 </code></pre>
</div>
</div>
<p>Here we see that the data is not balanced in our favor, there are less TRUEs than there are FALSEs, this is important as it will be harder for us to predict the trues than the falses. Next we need to find the factors that are causing the 19% of people having such high job satisfaction.</p>
<p>Next we split the data, so we can verify our findings on the testing data later using cross validation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>in_train <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data1<span class="sc">$</span>Satisfied, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)  <span class="co"># 70% for training</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> data1[ in_train,]</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">&lt;-</span> data1[<span class="sc">-</span>in_train,]</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(training)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3073</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(testing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 767</code></pre>
</div>
</div>
</section>
<section id="caret" class="level2">
<h2 class="anchored" data-anchor-id="caret">Caret</h2>
<p>The control function</p>
<p>We will use 5-fold cross validation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">classProbs =</span> T,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">summaryFunction=</span>twoClassSummary,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verboseIter =</span> T)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(training<span class="sc">$</span>Satisfied)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(testing<span class="sc">$</span>Satisfied)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"No"</span>,<span class="st">"Yes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rda" class="level2">
<h2 class="anchored" data-anchor-id="rda">RDA</h2>
<p>Here I set up and train a Regularized Discriminant Analysis (RDA) model to predict job satisfaction (Satisfied as a binary response variable). It uses caret for training with a repeated cross-validation method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a grid for the hyper-parameters</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>param_grid <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">gamma =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.2</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train to maximize AUC: metric="ROC"</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>ldaFit <span class="ot">&lt;-</span> <span class="fu">train</span>(Satisfied <span class="sc">~</span> ., </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">method =</span><span class="st">"rda"</span>, <span class="co">#name of the model</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> training, </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">tuneGrid =</span> param_grid,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>),</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">metric=</span><span class="st">"ROC"</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">trControl =</span> ctrl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1.Rep1: gamma=0.0, lambda=0.1 
- Fold1.Rep1: gamma=0.0, lambda=0.1 
+ Fold1.Rep1: gamma=0.2, lambda=0.1 
- Fold1.Rep1: gamma=0.2, lambda=0.1 
+ Fold1.Rep1: gamma=0.4, lambda=0.1 
- Fold1.Rep1: gamma=0.4, lambda=0.1 
+ Fold1.Rep1: gamma=0.6, lambda=0.1 
- Fold1.Rep1: gamma=0.6, lambda=0.1 
+ Fold1.Rep1: gamma=0.8, lambda=0.1 
- Fold1.Rep1: gamma=0.8, lambda=0.1 
+ Fold1.Rep1: gamma=1.0, lambda=0.1 
- Fold1.Rep1: gamma=1.0, lambda=0.1 
+ Fold1.Rep1: gamma=0.0, lambda=0.3 
- Fold1.Rep1: gamma=0.0, lambda=0.3 
+ Fold1.Rep1: gamma=0.2, lambda=0.3 
- Fold1.Rep1: gamma=0.2, lambda=0.3 
+ Fold1.Rep1: gamma=0.4, lambda=0.3 
- Fold1.Rep1: gamma=0.4, lambda=0.3 
+ Fold1.Rep1: gamma=0.6, lambda=0.3 
- Fold1.Rep1: gamma=0.6, lambda=0.3 
+ Fold1.Rep1: gamma=0.8, lambda=0.3 
- Fold1.Rep1: gamma=0.8, lambda=0.3 
+ Fold1.Rep1: gamma=1.0, lambda=0.3 
- Fold1.Rep1: gamma=1.0, lambda=0.3 
+ Fold1.Rep1: gamma=0.0, lambda=0.5 
- Fold1.Rep1: gamma=0.0, lambda=0.5 
+ Fold1.Rep1: gamma=0.2, lambda=0.5 
- Fold1.Rep1: gamma=0.2, lambda=0.5 
+ Fold1.Rep1: gamma=0.4, lambda=0.5 
- Fold1.Rep1: gamma=0.4, lambda=0.5 
+ Fold1.Rep1: gamma=0.6, lambda=0.5 
- Fold1.Rep1: gamma=0.6, lambda=0.5 
+ Fold1.Rep1: gamma=0.8, lambda=0.5 
- Fold1.Rep1: gamma=0.8, lambda=0.5 
+ Fold1.Rep1: gamma=1.0, lambda=0.5 
- Fold1.Rep1: gamma=1.0, lambda=0.5 
+ Fold1.Rep1: gamma=0.0, lambda=0.7 
- Fold1.Rep1: gamma=0.0, lambda=0.7 
+ Fold1.Rep1: gamma=0.2, lambda=0.7 
- Fold1.Rep1: gamma=0.2, lambda=0.7 
+ Fold1.Rep1: gamma=0.4, lambda=0.7 
- Fold1.Rep1: gamma=0.4, lambda=0.7 
+ Fold1.Rep1: gamma=0.6, lambda=0.7 
- Fold1.Rep1: gamma=0.6, lambda=0.7 
+ Fold1.Rep1: gamma=0.8, lambda=0.7 
- Fold1.Rep1: gamma=0.8, lambda=0.7 
+ Fold1.Rep1: gamma=1.0, lambda=0.7 
- Fold1.Rep1: gamma=1.0, lambda=0.7 
+ Fold1.Rep1: gamma=0.0, lambda=0.9 
- Fold1.Rep1: gamma=0.0, lambda=0.9 
+ Fold1.Rep1: gamma=0.2, lambda=0.9 
- Fold1.Rep1: gamma=0.2, lambda=0.9 
+ Fold1.Rep1: gamma=0.4, lambda=0.9 
- Fold1.Rep1: gamma=0.4, lambda=0.9 
+ Fold1.Rep1: gamma=0.6, lambda=0.9 
- Fold1.Rep1: gamma=0.6, lambda=0.9 
+ Fold1.Rep1: gamma=0.8, lambda=0.9 
- Fold1.Rep1: gamma=0.8, lambda=0.9 
+ Fold1.Rep1: gamma=1.0, lambda=0.9 
- Fold1.Rep1: gamma=1.0, lambda=0.9 
+ Fold2.Rep1: gamma=0.0, lambda=0.1 
- Fold2.Rep1: gamma=0.0, lambda=0.1 
+ Fold2.Rep1: gamma=0.2, lambda=0.1 
- Fold2.Rep1: gamma=0.2, lambda=0.1 
+ Fold2.Rep1: gamma=0.4, lambda=0.1 
- Fold2.Rep1: gamma=0.4, lambda=0.1 
+ Fold2.Rep1: gamma=0.6, lambda=0.1 
- Fold2.Rep1: gamma=0.6, lambda=0.1 
+ Fold2.Rep1: gamma=0.8, lambda=0.1 
- Fold2.Rep1: gamma=0.8, lambda=0.1 
+ Fold2.Rep1: gamma=1.0, lambda=0.1 
- Fold2.Rep1: gamma=1.0, lambda=0.1 
+ Fold2.Rep1: gamma=0.0, lambda=0.3 
- Fold2.Rep1: gamma=0.0, lambda=0.3 
+ Fold2.Rep1: gamma=0.2, lambda=0.3 
- Fold2.Rep1: gamma=0.2, lambda=0.3 
+ Fold2.Rep1: gamma=0.4, lambda=0.3 
- Fold2.Rep1: gamma=0.4, lambda=0.3 
+ Fold2.Rep1: gamma=0.6, lambda=0.3 
- Fold2.Rep1: gamma=0.6, lambda=0.3 
+ Fold2.Rep1: gamma=0.8, lambda=0.3 
- Fold2.Rep1: gamma=0.8, lambda=0.3 
+ Fold2.Rep1: gamma=1.0, lambda=0.3 
- Fold2.Rep1: gamma=1.0, lambda=0.3 
+ Fold2.Rep1: gamma=0.0, lambda=0.5 
- Fold2.Rep1: gamma=0.0, lambda=0.5 
+ Fold2.Rep1: gamma=0.2, lambda=0.5 
- Fold2.Rep1: gamma=0.2, lambda=0.5 
+ Fold2.Rep1: gamma=0.4, lambda=0.5 
- Fold2.Rep1: gamma=0.4, lambda=0.5 
+ Fold2.Rep1: gamma=0.6, lambda=0.5 
- Fold2.Rep1: gamma=0.6, lambda=0.5 
+ Fold2.Rep1: gamma=0.8, lambda=0.5 
- Fold2.Rep1: gamma=0.8, lambda=0.5 
+ Fold2.Rep1: gamma=1.0, lambda=0.5 
- Fold2.Rep1: gamma=1.0, lambda=0.5 
+ Fold2.Rep1: gamma=0.0, lambda=0.7 
- Fold2.Rep1: gamma=0.0, lambda=0.7 
+ Fold2.Rep1: gamma=0.2, lambda=0.7 
- Fold2.Rep1: gamma=0.2, lambda=0.7 
+ Fold2.Rep1: gamma=0.4, lambda=0.7 
- Fold2.Rep1: gamma=0.4, lambda=0.7 
+ Fold2.Rep1: gamma=0.6, lambda=0.7 
- Fold2.Rep1: gamma=0.6, lambda=0.7 
+ Fold2.Rep1: gamma=0.8, lambda=0.7 
- Fold2.Rep1: gamma=0.8, lambda=0.7 
+ Fold2.Rep1: gamma=1.0, lambda=0.7 
- Fold2.Rep1: gamma=1.0, lambda=0.7 
+ Fold2.Rep1: gamma=0.0, lambda=0.9 
- Fold2.Rep1: gamma=0.0, lambda=0.9 
+ Fold2.Rep1: gamma=0.2, lambda=0.9 
- Fold2.Rep1: gamma=0.2, lambda=0.9 
+ Fold2.Rep1: gamma=0.4, lambda=0.9 
- Fold2.Rep1: gamma=0.4, lambda=0.9 
+ Fold2.Rep1: gamma=0.6, lambda=0.9 
- Fold2.Rep1: gamma=0.6, lambda=0.9 
+ Fold2.Rep1: gamma=0.8, lambda=0.9 
- Fold2.Rep1: gamma=0.8, lambda=0.9 
+ Fold2.Rep1: gamma=1.0, lambda=0.9 
- Fold2.Rep1: gamma=1.0, lambda=0.9 
+ Fold3.Rep1: gamma=0.0, lambda=0.1 
- Fold3.Rep1: gamma=0.0, lambda=0.1 
+ Fold3.Rep1: gamma=0.2, lambda=0.1 
- Fold3.Rep1: gamma=0.2, lambda=0.1 
+ Fold3.Rep1: gamma=0.4, lambda=0.1 
- Fold3.Rep1: gamma=0.4, lambda=0.1 
+ Fold3.Rep1: gamma=0.6, lambda=0.1 
- Fold3.Rep1: gamma=0.6, lambda=0.1 
+ Fold3.Rep1: gamma=0.8, lambda=0.1 
- Fold3.Rep1: gamma=0.8, lambda=0.1 
+ Fold3.Rep1: gamma=1.0, lambda=0.1 
- Fold3.Rep1: gamma=1.0, lambda=0.1 
+ Fold3.Rep1: gamma=0.0, lambda=0.3 
- Fold3.Rep1: gamma=0.0, lambda=0.3 
+ Fold3.Rep1: gamma=0.2, lambda=0.3 
- Fold3.Rep1: gamma=0.2, lambda=0.3 
+ Fold3.Rep1: gamma=0.4, lambda=0.3 
- Fold3.Rep1: gamma=0.4, lambda=0.3 
+ Fold3.Rep1: gamma=0.6, lambda=0.3 
- Fold3.Rep1: gamma=0.6, lambda=0.3 
+ Fold3.Rep1: gamma=0.8, lambda=0.3 
- Fold3.Rep1: gamma=0.8, lambda=0.3 
+ Fold3.Rep1: gamma=1.0, lambda=0.3 
- Fold3.Rep1: gamma=1.0, lambda=0.3 
+ Fold3.Rep1: gamma=0.0, lambda=0.5 
- Fold3.Rep1: gamma=0.0, lambda=0.5 
+ Fold3.Rep1: gamma=0.2, lambda=0.5 
- Fold3.Rep1: gamma=0.2, lambda=0.5 
+ Fold3.Rep1: gamma=0.4, lambda=0.5 
- Fold3.Rep1: gamma=0.4, lambda=0.5 
+ Fold3.Rep1: gamma=0.6, lambda=0.5 
- Fold3.Rep1: gamma=0.6, lambda=0.5 
+ Fold3.Rep1: gamma=0.8, lambda=0.5 
- Fold3.Rep1: gamma=0.8, lambda=0.5 
+ Fold3.Rep1: gamma=1.0, lambda=0.5 
- Fold3.Rep1: gamma=1.0, lambda=0.5 
+ Fold3.Rep1: gamma=0.0, lambda=0.7 
- Fold3.Rep1: gamma=0.0, lambda=0.7 
+ Fold3.Rep1: gamma=0.2, lambda=0.7 
- Fold3.Rep1: gamma=0.2, lambda=0.7 
+ Fold3.Rep1: gamma=0.4, lambda=0.7 
- Fold3.Rep1: gamma=0.4, lambda=0.7 
+ Fold3.Rep1: gamma=0.6, lambda=0.7 
- Fold3.Rep1: gamma=0.6, lambda=0.7 
+ Fold3.Rep1: gamma=0.8, lambda=0.7 
- Fold3.Rep1: gamma=0.8, lambda=0.7 
+ Fold3.Rep1: gamma=1.0, lambda=0.7 
- Fold3.Rep1: gamma=1.0, lambda=0.7 
+ Fold3.Rep1: gamma=0.0, lambda=0.9 
- Fold3.Rep1: gamma=0.0, lambda=0.9 
+ Fold3.Rep1: gamma=0.2, lambda=0.9 
- Fold3.Rep1: gamma=0.2, lambda=0.9 
+ Fold3.Rep1: gamma=0.4, lambda=0.9 
- Fold3.Rep1: gamma=0.4, lambda=0.9 
+ Fold3.Rep1: gamma=0.6, lambda=0.9 
- Fold3.Rep1: gamma=0.6, lambda=0.9 
+ Fold3.Rep1: gamma=0.8, lambda=0.9 
- Fold3.Rep1: gamma=0.8, lambda=0.9 
+ Fold3.Rep1: gamma=1.0, lambda=0.9 
- Fold3.Rep1: gamma=1.0, lambda=0.9 
+ Fold4.Rep1: gamma=0.0, lambda=0.1 
- Fold4.Rep1: gamma=0.0, lambda=0.1 
+ Fold4.Rep1: gamma=0.2, lambda=0.1 
- Fold4.Rep1: gamma=0.2, lambda=0.1 
+ Fold4.Rep1: gamma=0.4, lambda=0.1 
- Fold4.Rep1: gamma=0.4, lambda=0.1 
+ Fold4.Rep1: gamma=0.6, lambda=0.1 
- Fold4.Rep1: gamma=0.6, lambda=0.1 
+ Fold4.Rep1: gamma=0.8, lambda=0.1 
- Fold4.Rep1: gamma=0.8, lambda=0.1 
+ Fold4.Rep1: gamma=1.0, lambda=0.1 
- Fold4.Rep1: gamma=1.0, lambda=0.1 
+ Fold4.Rep1: gamma=0.0, lambda=0.3 
- Fold4.Rep1: gamma=0.0, lambda=0.3 
+ Fold4.Rep1: gamma=0.2, lambda=0.3 
- Fold4.Rep1: gamma=0.2, lambda=0.3 
+ Fold4.Rep1: gamma=0.4, lambda=0.3 
- Fold4.Rep1: gamma=0.4, lambda=0.3 
+ Fold4.Rep1: gamma=0.6, lambda=0.3 
- Fold4.Rep1: gamma=0.6, lambda=0.3 
+ Fold4.Rep1: gamma=0.8, lambda=0.3 
- Fold4.Rep1: gamma=0.8, lambda=0.3 
+ Fold4.Rep1: gamma=1.0, lambda=0.3 
- Fold4.Rep1: gamma=1.0, lambda=0.3 
+ Fold4.Rep1: gamma=0.0, lambda=0.5 
- Fold4.Rep1: gamma=0.0, lambda=0.5 
+ Fold4.Rep1: gamma=0.2, lambda=0.5 
- Fold4.Rep1: gamma=0.2, lambda=0.5 
+ Fold4.Rep1: gamma=0.4, lambda=0.5 
- Fold4.Rep1: gamma=0.4, lambda=0.5 
+ Fold4.Rep1: gamma=0.6, lambda=0.5 
- Fold4.Rep1: gamma=0.6, lambda=0.5 
+ Fold4.Rep1: gamma=0.8, lambda=0.5 
- Fold4.Rep1: gamma=0.8, lambda=0.5 
+ Fold4.Rep1: gamma=1.0, lambda=0.5 
- Fold4.Rep1: gamma=1.0, lambda=0.5 
+ Fold4.Rep1: gamma=0.0, lambda=0.7 
- Fold4.Rep1: gamma=0.0, lambda=0.7 
+ Fold4.Rep1: gamma=0.2, lambda=0.7 
- Fold4.Rep1: gamma=0.2, lambda=0.7 
+ Fold4.Rep1: gamma=0.4, lambda=0.7 
- Fold4.Rep1: gamma=0.4, lambda=0.7 
+ Fold4.Rep1: gamma=0.6, lambda=0.7 
- Fold4.Rep1: gamma=0.6, lambda=0.7 
+ Fold4.Rep1: gamma=0.8, lambda=0.7 
- Fold4.Rep1: gamma=0.8, lambda=0.7 
+ Fold4.Rep1: gamma=1.0, lambda=0.7 
- Fold4.Rep1: gamma=1.0, lambda=0.7 
+ Fold4.Rep1: gamma=0.0, lambda=0.9 
- Fold4.Rep1: gamma=0.0, lambda=0.9 
+ Fold4.Rep1: gamma=0.2, lambda=0.9 
- Fold4.Rep1: gamma=0.2, lambda=0.9 
+ Fold4.Rep1: gamma=0.4, lambda=0.9 
- Fold4.Rep1: gamma=0.4, lambda=0.9 
+ Fold4.Rep1: gamma=0.6, lambda=0.9 
- Fold4.Rep1: gamma=0.6, lambda=0.9 
+ Fold4.Rep1: gamma=0.8, lambda=0.9 
- Fold4.Rep1: gamma=0.8, lambda=0.9 
+ Fold4.Rep1: gamma=1.0, lambda=0.9 
- Fold4.Rep1: gamma=1.0, lambda=0.9 
+ Fold5.Rep1: gamma=0.0, lambda=0.1 
- Fold5.Rep1: gamma=0.0, lambda=0.1 
+ Fold5.Rep1: gamma=0.2, lambda=0.1 
- Fold5.Rep1: gamma=0.2, lambda=0.1 
+ Fold5.Rep1: gamma=0.4, lambda=0.1 
- Fold5.Rep1: gamma=0.4, lambda=0.1 
+ Fold5.Rep1: gamma=0.6, lambda=0.1 
- Fold5.Rep1: gamma=0.6, lambda=0.1 
+ Fold5.Rep1: gamma=0.8, lambda=0.1 
- Fold5.Rep1: gamma=0.8, lambda=0.1 
+ Fold5.Rep1: gamma=1.0, lambda=0.1 
- Fold5.Rep1: gamma=1.0, lambda=0.1 
+ Fold5.Rep1: gamma=0.0, lambda=0.3 
- Fold5.Rep1: gamma=0.0, lambda=0.3 
+ Fold5.Rep1: gamma=0.2, lambda=0.3 
- Fold5.Rep1: gamma=0.2, lambda=0.3 
+ Fold5.Rep1: gamma=0.4, lambda=0.3 
- Fold5.Rep1: gamma=0.4, lambda=0.3 
+ Fold5.Rep1: gamma=0.6, lambda=0.3 
- Fold5.Rep1: gamma=0.6, lambda=0.3 
+ Fold5.Rep1: gamma=0.8, lambda=0.3 
- Fold5.Rep1: gamma=0.8, lambda=0.3 
+ Fold5.Rep1: gamma=1.0, lambda=0.3 
- Fold5.Rep1: gamma=1.0, lambda=0.3 
+ Fold5.Rep1: gamma=0.0, lambda=0.5 
- Fold5.Rep1: gamma=0.0, lambda=0.5 
+ Fold5.Rep1: gamma=0.2, lambda=0.5 
- Fold5.Rep1: gamma=0.2, lambda=0.5 
+ Fold5.Rep1: gamma=0.4, lambda=0.5 
- Fold5.Rep1: gamma=0.4, lambda=0.5 
+ Fold5.Rep1: gamma=0.6, lambda=0.5 
- Fold5.Rep1: gamma=0.6, lambda=0.5 
+ Fold5.Rep1: gamma=0.8, lambda=0.5 
- Fold5.Rep1: gamma=0.8, lambda=0.5 
+ Fold5.Rep1: gamma=1.0, lambda=0.5 
- Fold5.Rep1: gamma=1.0, lambda=0.5 
+ Fold5.Rep1: gamma=0.0, lambda=0.7 
- Fold5.Rep1: gamma=0.0, lambda=0.7 
+ Fold5.Rep1: gamma=0.2, lambda=0.7 
- Fold5.Rep1: gamma=0.2, lambda=0.7 
+ Fold5.Rep1: gamma=0.4, lambda=0.7 
- Fold5.Rep1: gamma=0.4, lambda=0.7 
+ Fold5.Rep1: gamma=0.6, lambda=0.7 
- Fold5.Rep1: gamma=0.6, lambda=0.7 
+ Fold5.Rep1: gamma=0.8, lambda=0.7 
- Fold5.Rep1: gamma=0.8, lambda=0.7 
+ Fold5.Rep1: gamma=1.0, lambda=0.7 
- Fold5.Rep1: gamma=1.0, lambda=0.7 
+ Fold5.Rep1: gamma=0.0, lambda=0.9 
- Fold5.Rep1: gamma=0.0, lambda=0.9 
+ Fold5.Rep1: gamma=0.2, lambda=0.9 
- Fold5.Rep1: gamma=0.2, lambda=0.9 
+ Fold5.Rep1: gamma=0.4, lambda=0.9 
- Fold5.Rep1: gamma=0.4, lambda=0.9 
+ Fold5.Rep1: gamma=0.6, lambda=0.9 
- Fold5.Rep1: gamma=0.6, lambda=0.9 
+ Fold5.Rep1: gamma=0.8, lambda=0.9 
- Fold5.Rep1: gamma=0.8, lambda=0.9 
+ Fold5.Rep1: gamma=1.0, lambda=0.9 
- Fold5.Rep1: gamma=1.0, lambda=0.9 
Aggregating results
Selecting tuning parameters
Fitting gamma = 0.4, lambda = 0.9 on full training set</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ldaFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Regularized Discriminant Analysis 

3073 samples
  27 predictor
   2 classes: 'No', 'Yes' 

Pre-processing: centered (27), scaled (27) 
Resampling: Cross-Validated (5 fold, repeated 1 times) 
Summary of sample sizes: 2458, 2458, 2458, 2459, 2459 
Resampling results across tuning parameters:

  gamma  lambda  ROC        Sens       Spec     
  0.0    0.1     0.7297839  0.8094146  0.4888762
  0.0    0.3     0.7349015  0.8376266  0.4448796
  0.0    0.5     0.7411331  0.8565668  0.4195129
  0.0    0.7     0.7493309  0.8751022  0.3822960
  0.0    0.9     0.7599956  0.9069360  0.3164079
  0.2    0.1     0.7367956  0.8412548  0.4431847
  0.2    0.3     0.7415183  0.8549564  0.4127617
  0.2    0.5     0.7468653  0.8654313  0.3941604
  0.2    0.7     0.7523976  0.8827578  0.3654038
  0.2    0.9     0.7601543  0.9065336  0.3383706
  0.4    0.1     0.7433022  0.8533451  0.4178322
  0.4    0.3     0.7466784  0.8601926  0.4059963
  0.4    0.5     0.7501712  0.8710740  0.3924655
  0.4    0.7     0.7548032  0.8795353  0.3755733
  0.4    0.9     0.7604193  0.8964602  0.3586811
  0.6    0.1     0.7483043  0.8557612  0.4195414
  0.6    0.3     0.7504376  0.8638192  0.4094004
  0.6    0.5     0.7529825  0.8666410  0.4060248
  0.6    0.7     0.7562394  0.8730861  0.3992451
  0.6    0.9     0.7599703  0.8799409  0.3874377
  0.8    0.1     0.7516646  0.8477048  0.4431847
  0.8    0.3     0.7532006  0.8481072  0.4499644
  0.8    0.5     0.7545251  0.8513306  0.4567441
  0.8    0.7     0.7564199  0.8525402  0.4499929
  0.8    0.9     0.7577961  0.8549580  0.4483122
  1.0    0.1     0.7508115  0.8267541  0.4855006
  1.0    0.3     0.7518426  0.8279629  0.4871956
  1.0    0.5     0.7528504  0.8275605  0.4855006
  1.0    0.7     0.7536702  0.8279638  0.4871956
  1.0    0.9     0.7542677  0.8263525  0.4888905

ROC was used to select the optimal model using the largest value.
The final values used for the model were gamma = 0.4 and lambda = 0.9.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict and validate</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>ldaPred <span class="ot">=</span> <span class="fu">predict</span>(ldaFit, testing)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(ldaPred, testing<span class="sc">$</span>Satisfied)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  538  98
       Yes  82  49
                                          
               Accuracy : 0.7653          
                 95% CI : (0.7337, 0.7949)
    No Information Rate : 0.8083          
    P-Value [Acc &gt; NIR] : 0.9987          
                                          
                  Kappa : 0.2098          
                                          
 Mcnemar's Test P-Value : 0.2636          
                                          
            Sensitivity : 0.8677          
            Specificity : 0.3333          
         Pos Pred Value : 0.8459          
         Neg Pred Value : 0.3740          
             Prevalence : 0.8083          
         Detection Rate : 0.7014          
   Detection Prevalence : 0.8292          
      Balanced Accuracy : 0.6005          
                                          
       'Positive' Class : No              
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>ldaProb <span class="ot">=</span> <span class="fu">predict</span>(ldaFit, testing, <span class="at">type=</span><span class="st">"prob"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(ldaProb[,<span class="dv">2</span>] <span class="sc">&gt;</span> threshold, <span class="st">"Yes"</span>, <span class="st">"No"</span>)) <span class="co">#manual way to predict, instead of using caret we predict by hand. bc caret automatically predicts with 0.5</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ldaProb[,2] means that prob of pass is 0.8 and prob of fail is 0.2 thats why we want the 2nd column.</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No  457  58
       Yes 163  89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.7118644 0.2691931 </code></pre>
</div>
</div>
<p>It shows the results of the cross-validation for different combinations of gamma and lambda. The model selects gamma = 1 and lambda = 0.9 as the best parameters based on the ROC value, which measures the ability to distinguish between the two classes. The model achieves an accuracy of 71.37% with a Kappa of 0.1262. This indicates a fair agreement beyond chance. However, the model is better at predicting “No” (No satisfaction) rather than “Yes” (Satisfaction), as seen from the higher positive predictive value (PPV) and sensitivity for the “No” class. Otherwise this model is quite good with a decent accuracy and good balance of sensitivity and specificity.</p>
<p>Then I adjusted the threshold Prediction. You manually adjust the threshold for predicting “Yes” to 0.2, which is lower than the default 0.5. This makes the model predict “Yes” more liberally. With the adjusted threshold, the accuracy slightly decreases to 69%, and Kappa increases marginally to 0.187. It indicates that changing the threshold has a modest impact on the balance between sensitivity and specificity.</p>
</section>
<section id="benchmark-model" class="level2">
<h2 class="anchored" data-anchor-id="benchmark-model">Benchmark Model :</h2>
<p>Here I test a logistic regression model (glm) with my binary outcome variable is created using only the intercept (no predictors, Satisfied ~ 1), meaning it’s a simple model that predicts the majority class for all observations. This model serves as a baseline to evaluate the performance of more complex models. The predict function is then used to generate probabilities (prob.bench) for the testing set based on this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>bench.model <span class="ot">=</span> <span class="fu">glm</span>(Satisfied <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">'logit'</span>), <span class="at">data=</span>training)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>prob.bench <span class="ot">=</span> <span class="fu">predict</span>(bench.model, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>roc.lda<span class="ot">=</span><span class="fu">roc</span>(testing<span class="sc">$</span>Satisfied <span class="sc">~</span> ldaProb[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = No, case = Yes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>roc.bench<span class="ot">=</span><span class="fu">roc</span>(testing<span class="sc">$</span>Satisfied <span class="sc">~</span> prob.bench)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = No, case = Yes
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.lda, <span class="at">col=</span><span class="st">"red"</span>,<span class="at">print.thres=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc.bench, <span class="at">add=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">'green'</span>,<span class="at">print.thres=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"lda"</span>, <span class="st">"bench"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"red"</span>,  <span class="st">"green"</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>roc.lda<span class="sc">$</span>auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.7373</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>roc.bench<span class="sc">$</span>auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Area under the curve: 0.5</code></pre>
</div>
</div>
<p>The closer the ROC curve is to the upper left corner, the higher the overall accuracy of the test to correctly classify the positive cases. The AUC (Area Under the Curve) for the “lda” model is labeled as 0.72, which is better than the benchmark model. This suggests that the “lda” model has better discrimination capabilities between the positive and negative cases, however it could be better. The coordinates (0.657, 0.729) represent sensitivity and specificity, respectively, at this threshold.</p>
<p>The “bench” model, on the other hand, has an AUC of 0.5, which is equivalent to a random guess. Its ROC curve is a straight line along the diagonal, which indicates that it has no discriminative power between the positive and negative cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">=</span> <span class="fl">0.7</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>ldaProb <span class="ot">=</span> <span class="fu">predict</span>(ldaFit, testing, <span class="at">type=</span><span class="st">"prob"</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(ldaProb[,<span class="dv">2</span>] <span class="sc">&gt;</span> threshold, <span class="st">"Yes"</span>, <span class="st">"No"</span>)) <span class="co">#manual way to predict, instead of using caret we predict by hand. bc caret automatically predicts with 0.5</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No  570 114
       Yes  50  33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.7861799 0.1724909 </code></pre>
</div>
</div>
<p>Here I test it out with one more threshold and it looks good, better than the last threshold.</p>
<section id="knn" class="level3">
<h3 class="anchored" data-anchor-id="knn">knn</h3>
<p>The train function from the caret package is being used, specifying KNN as the method (with method = “kknn”). Data is being preprocessed by scaling and centering (standardizing) the predictors. The tuneLength parameter is set to 10, which means caret will try 10 different values of the number of neighbors to find the best model based on the ROC metric. trControl is a train control object that specifies the cross-validation method, which is not shown in the snippet but is likely set elsewhere in the code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>knnFit <span class="ot">&lt;-</span> <span class="fu">train</span>(Satisfied <span class="sc">~</span> ., </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> training,</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"kknn"</span>,  <span class="co">#now method is KNN </span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">preProc=</span><span class="fu">c</span>(<span class="st">'scale'</span>,<span class="st">'center'</span>),</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tuneLength =</span> <span class="dv">10</span>, <span class="co">#select a greed of 10 expend.grid()</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metric=</span><span class="st">"ROC"</span>,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">trControl =</span> ctrl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1.Rep1: kmax= 5, distance=2, kernel=optimal 
- Fold1.Rep1: kmax= 5, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax= 7, distance=2, kernel=optimal 
- Fold1.Rep1: kmax= 7, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax= 9, distance=2, kernel=optimal 
- Fold1.Rep1: kmax= 9, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=11, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=11, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=13, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=13, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=15, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=15, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=17, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=17, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=19, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=19, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=21, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=21, distance=2, kernel=optimal 
+ Fold1.Rep1: kmax=23, distance=2, kernel=optimal 
- Fold1.Rep1: kmax=23, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax= 5, distance=2, kernel=optimal 
- Fold2.Rep1: kmax= 5, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax= 7, distance=2, kernel=optimal 
- Fold2.Rep1: kmax= 7, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax= 9, distance=2, kernel=optimal 
- Fold2.Rep1: kmax= 9, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=11, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=11, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=13, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=13, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=15, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=15, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=17, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=17, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=19, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=19, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=21, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=21, distance=2, kernel=optimal 
+ Fold2.Rep1: kmax=23, distance=2, kernel=optimal 
- Fold2.Rep1: kmax=23, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax= 5, distance=2, kernel=optimal 
- Fold3.Rep1: kmax= 5, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax= 7, distance=2, kernel=optimal 
- Fold3.Rep1: kmax= 7, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax= 9, distance=2, kernel=optimal 
- Fold3.Rep1: kmax= 9, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=11, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=11, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=13, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=13, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=15, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=15, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=17, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=17, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=19, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=19, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=21, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=21, distance=2, kernel=optimal 
+ Fold3.Rep1: kmax=23, distance=2, kernel=optimal 
- Fold3.Rep1: kmax=23, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax= 5, distance=2, kernel=optimal 
- Fold4.Rep1: kmax= 5, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax= 7, distance=2, kernel=optimal 
- Fold4.Rep1: kmax= 7, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax= 9, distance=2, kernel=optimal 
- Fold4.Rep1: kmax= 9, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=11, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=11, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=13, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=13, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=15, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=15, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=17, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=17, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=19, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=19, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=21, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=21, distance=2, kernel=optimal 
+ Fold4.Rep1: kmax=23, distance=2, kernel=optimal 
- Fold4.Rep1: kmax=23, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax= 5, distance=2, kernel=optimal 
- Fold5.Rep1: kmax= 5, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax= 7, distance=2, kernel=optimal 
- Fold5.Rep1: kmax= 7, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax= 9, distance=2, kernel=optimal 
- Fold5.Rep1: kmax= 9, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=11, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=11, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=13, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=13, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=15, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=15, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=17, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=17, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=19, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=19, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=21, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=21, distance=2, kernel=optimal 
+ Fold5.Rep1: kmax=23, distance=2, kernel=optimal 
- Fold5.Rep1: kmax=23, distance=2, kernel=optimal 
Aggregating results
Selecting tuning parameters
Fitting kmax = 23, distance = 2, kernel = optimal on full training set</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knnFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>knnProb <span class="ot">=</span> <span class="fu">predict</span>(knnFit, testing, <span class="at">type=</span><span class="st">"prob"</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(knnProb[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">0.1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No  274  34
       Yes 346 113</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.5045632 0.1164023 </code></pre>
</div>
</div>
<p>According to the confusion matrix there are only 70 true negatives and 40 true positives, but also a number of false negatives (137). Accuracy: About 43% of the predictions made by the model are correct. This model isn’t performing well, especially as the Kappa statistic is only around 0.08</p>
<p>The plot shows the performance of different KNN models with varying numbers of neighbors. The best performance seems to be achieved with about 7 neighbors, as the ROC curve starts to plateau beyond this point (although quite steeply still).</p>
</section>
</section>
<section id="decision-trees" class="level2">
<h2 class="anchored" data-anchor-id="decision-trees">Decision trees</h2>
<p>We create a classification tree to attempt this method of prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyper-parameters</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">30</span>, <span class="at">maxdepth =</span> <span class="dv">10</span>, <span class="at">cp=</span><span class="fl">0.01</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co"># minsplit: minimum number of observations in a node before before a split</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co"># maxdepth: maximum depth of any node of the final tree</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># cp: degree of complexity, the smaller the more branches</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The decision tree:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> Satisfied <span class="sc">~</span>.</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>dtFit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(model, <span class="at">data=</span>training, <span class="at">method =</span> <span class="st">"class"</span>, <span class="at">control =</span> control)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dtFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = model, data = training, method = "class", control = control)
  n= 3073 

          CP nsplit rel error   xerror       xstd
1 0.01522843      0 1.0000000 1.000000 0.03696799
2 0.01184433      2 0.9695431 1.000000 0.03696799
3 0.01000000      3 0.9576988 0.998308 0.03694414

Variable importance
  employ   empcat   income      car filter_$      age   gender 
      33       27       12       11        9        6        1 

Node number 1: 3073 observations,    complexity param=0.01522843
  predicted class=No   expected loss=0.1923202  P(node) =1
    class counts:  2482   591
   probabilities: 0.808 0.192 
  left son=2 (2132 obs) right son=3 (941 obs)
  Primary splits:
      employ   &lt; 13.5  to the left,  improve=109.46160, (0 missing)
      empcat   &lt; 2.5   to the left,  improve=101.62390, (0 missing)
      income   &lt; 80.5  to the left,  improve= 60.80786, (0 missing)
      car      &lt; 416.5 to the left,  improve= 57.04984, (0 missing)
      filter_$ &lt; 0.5   to the right, improve= 51.76932, (0 missing)
  Surrogate splits:
      empcat   &lt; 2.5   to the left,  agree=0.971, adj=0.906, (0 split)
      income   &lt; 80.5  to the left,  agree=0.814, adj=0.393, (0 split)
      car      &lt; 403.5 to the left,  agree=0.806, adj=0.366, (0 split)
      filter_$ &lt; 0.5   to the right, agree=0.791, adj=0.317, (0 split)
      age      &lt; 46.5  to the left,  agree=0.758, adj=0.209, (0 split)

Node number 2: 2132 observations
  predicted class=No   expected loss=0.1036585  P(node) =0.6937846
    class counts:  1911   221
   probabilities: 0.896 0.104 

Node number 3: 941 observations,    complexity param=0.01522843
  predicted class=No   expected loss=0.3931987  P(node) =0.3062154
    class counts:   571   370
   probabilities: 0.607 0.393 
  left son=6 (819 obs) right son=7 (122 obs)
  Primary splits:
      employ   &lt; 31.5  to the left,  improve=9.141032, (0 missing)
      income   &lt; 126.5 to the left,  improve=5.673001, (0 missing)
      car      &lt; 594.5 to the left,  improve=5.137693, (0 missing)
      filter_$ &lt; 0.5   to the right, improve=4.393415, (0 missing)
      address  &lt; 6.5   to the left,  improve=2.834144, (0 missing)
  Surrogate splits:
      income &lt; 462   to the left,  agree=0.879, adj=0.066, (0 split)
      car    &lt; 990.5 to the left,  agree=0.872, adj=0.016, (0 split)

Node number 6: 819 observations
  predicted class=No   expected loss=0.3663004  P(node) =0.2665148
    class counts:   519   300
   probabilities: 0.634 0.366 

Node number 7: 122 observations,    complexity param=0.01184433
  predicted class=Yes  expected loss=0.4262295  P(node) =0.03970062
    class counts:    52    70
   probabilities: 0.426 0.574 
  left son=14 (59 obs) right son=15 (63 obs)
  Primary splits:
      gender  splits as  LR,        improve=4.0477030, (0 missing)
      income  &lt; 166   to the left,  improve=1.2033810, (0 missing)
      car     &lt; 869   to the left,  improve=1.1149880, (0 missing)
      age     &lt; 62.5  to the left,  improve=0.9078291, (0 missing)
      address &lt; 8.5   to the left,  improve=0.7630402, (0 missing)
  Surrogate splits:
      employ   &lt; 36.5  to the left,  agree=0.574, adj=0.119, (0 split)
      address  &lt; 29.5  to the right, agree=0.566, adj=0.102, (0 split)
      car      &lt; 762   to the right, agree=0.557, adj=0.085, (0 split)
      wireless &lt; 0.5   to the left,  agree=0.557, adj=0.085, (0 split)
      callwait &lt; 0.5   to the left,  agree=0.557, adj=0.085, (0 split)

Node number 14: 59 observations
  predicted class=No   expected loss=0.440678  P(node) =0.01919948
    class counts:    33    26
   probabilities: 0.559 0.441 

Node number 15: 63 observations
  predicted class=Yes  expected loss=0.3015873  P(node) =0.02050114
    class counts:    19    44
   probabilities: 0.302 0.698 </code></pre>
</div>
</div>
<p>The summary shows:</p>
<p>Two splits have been attempted, with the complexity parameter (CP) indicating how much the relative error needs to increase by at each split to justify keeping that split (in this case 0.01). Variable importance indicates employ is the most significant predictor, followed by empcat and income. The decision tree then makes a primary split on the employ variable, splitting the data into those with employ less than 8 and those with employ greater than or equal to 8 (so having been employed for more or less than 8 months significantly affects if you are very satisfied in your job). This split seems to be the most significant in separating the classes according to the “improve” metric in the summary output.</p>
<p>The subsequent splits and the respective nodes’ predicted classes and probabilities suggest how the model is using the predictor variables to classify the data. For instance, the second split is made on employment years being less or more than 15, and then income with the split at 354€.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(dtFit, <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The plot shows the structure of the decision tree, with the split conditions and the percentage of observations in each node. It provides a visual interpretation of how the tree is making its decisions. The tree suggests that the employ variable is the primary splitter for classifying satisfaction, with income as a secondary splitter. The numbers in each node give us the probability of misclassification within that node and the proportion of the total dataset that ends up there.</p>
<p>It is also impoortant to note many nodes have been removed (pruning) in this model, for example employment category (empcat) was removed in the model even though it was deemed important. I want to see how this could look if it was more complete (however I am not confident it will make a better model)</p>
<p>I don’t want to make a complete tree since I won’t be able to read much of it, so I expand the tree by setting the cp lower to 0.005.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>control <span class="ot">=</span> <span class="fu">rpart.control</span>(<span class="at">minsplit =</span> <span class="dv">8</span>, <span class="at">maxdepth =</span> <span class="dv">12</span>, <span class="at">cp=</span><span class="fl">0.005</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>dtFit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(model, <span class="at">data=</span>training, <span class="at">method =</span> <span class="st">"class"</span>, <span class="at">control =</span> control)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(dtFit, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the plot is time consuming</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="prediction" class="level3">
<h3 class="anchored" data-anchor-id="prediction">Prediction:</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>dtPred <span class="ot">&lt;-</span> <span class="fu">predict</span>(dtFit, testing, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>dtProb <span class="ot">&lt;-</span> <span class="fu">predict</span>(dtFit, testing, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(dtProb[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">0.1</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No    1   3
       Yes 619 144</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Accuracy       Kappa 
 0.18904824 -0.00723322 </code></pre>
</div>
</div>
<p>The accuracy is not terribly low at approximately 59%, and the Kappa statistic is at 20%. We see quite a lot of false negatives, which is not dangerous but it seems this is not the best model for our case but we get interesting findings about which variables could be considered important later on.</p>
</section>
</section>
<section id="predictions-using-regression-models" class="level2">
<h2 class="anchored" data-anchor-id="predictions-using-regression-models">Predictions using regression models</h2>
<p>Since my target variable is binary and my predictor variables are mostly categorical variables, the type of models done are more limited, and I cannot just do any and all variables as they do not support my types of variables.</p>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic regression</h2>
<p>Because we have binary classification, we can use the standard glm function in R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>logit.model <span class="ot">&lt;-</span>  <span class="fu">glm</span>(Satisfied <span class="sc">~</span> . ,<span class="at">data =</span> training, <span class="at">family =</span> binomial)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>                     </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co">#OR HIS code that works with rest of code</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>logit.model <span class="ot">=</span> <span class="fu">glm</span>(Satisfied <span class="sc">~</span>., <span class="at">data =</span> training, <span class="at">family =</span> binomial)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Satisfied ~ ., family = binomial, data = training)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -5.0522442  1.1548955  -4.375 1.22e-05 ***
age          0.0020228  0.0070837   0.286   0.7752    
marital      0.2007085  0.1361377   1.474   0.1404    
address     -0.0008192  0.0059592  -0.137   0.8907    
income       0.0003905  0.0008459   0.462   0.6443    
car          0.0005869  0.0003244   1.809   0.0705 .  
ed          -0.0522840  0.0510419  -1.024   0.3057    
employ       0.0496745  0.0117496   4.228 2.36e-05 ***
retire       0.0083822  0.2577700   0.033   0.9741    
empcat       0.5479434  0.1328550   4.124 3.72e-05 ***
genderm      0.1340797  0.1006775   1.332   0.1829    
reside      -0.0749324  0.0499499  -1.500   0.1336    
wireless    -0.2686794  0.1231401  -2.182   0.0291 *  
multline     0.1444877  0.1123775   1.286   0.1985    
voice       -0.0332145  0.1096061  -0.303   0.7619    
pager       -0.1698665  0.1214688  -1.398   0.1620    
internet    -0.0062644  0.0300623  -0.208   0.8349    
callid       0.0361869  0.1125427   0.322   0.7478    
callwait    -0.0049754  0.1123544  -0.044   0.9647    
owntv        1.2708835  1.0852195   1.171   0.2416    
ownvcr      -0.0364544  0.3999586  -0.091   0.9274    
owncd        0.3909966  0.4794745   0.815   0.4148    
ownpda       0.0484726  0.1507089   0.322   0.7477    
ownpc        0.1616045  0.1124256   1.437   0.1506    
ownfax       0.0727295  0.1511475   0.481   0.6304    
news         0.1102811  0.1129349   0.977   0.3288    
response    -0.0934647  0.1642000  -0.569   0.5692    
`filter_$`   0.0540768  0.2026222   0.267   0.7896    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3008.9  on 3072  degrees of freedom
Residual deviance: 2556.8  on 3045  degrees of freedom
AIC: 2612.8

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>We see a decent level of residual deviance and AIC indicating that this model is not terrible.We also see that only employment category is highly significant along with having your own wireless device which doesn’t make much sense.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(logit.model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age     marital     address      income         car 
0.006394965 1.002024881 1.222268434 0.999181172 1.000390611 1.000587071 
         ed      employ      retire      empcat     genderm      reside 
0.949059305 1.050928966 1.008417402 1.729692132 1.143483950 0.927806236 
   wireless    multline       voice       pager    internet      callid 
0.764388295 1.155447488 0.967331046 0.843777478 0.993755218 1.036849645 
   callwait       owntv      ownvcr       owncd      ownpda       ownpc 
0.995036952 3.563999883 0.964202104 1.478453475 1.049666662 1.175395337 
     ownfax        news    response  `filter_$` 
1.075439572 1.116591914 0.910770138 1.055565652 </code></pre>
</div>
</div>
<p>Here are the exponentiated coefficients from the logistic regression model. These exponentiated coefficients are also known as odds ratios. An odds ratio provides a measure of the association between the predictor and the response variable.</p>
<p>Odds Ratio &gt; 1: An odds ratio greater than 1 indicates that as the predictor increases, the odds of the outcome occurring increase.</p>
<p>Odds Ratio &lt; 1: An odds ratio less than 1 suggests that as the predictor increases, the odds of the outcome decrease.</p>
<p>Odds Ratio = 1: An odds ratio of 1 indicates no association between the predictor and the outcome. The odds of the outcome occurring do not change as the predictor changes.</p>
<p>For example, looking at some specific variables:</p>
<p>age: The odds ratio is 0.99431762, suggesting a very slight decrease in the odds of being ‘Satisfied’ with each additional year of age. marital: With an odds ratio of 0.74013589, there is an indication that changes in marital status are associated with an increase in the odds of being ‘Satisfied’. Thus being married decreases your job satisfcation employ: An odds ratio of 1.02186237 means that each additional year of employment is associated with a 2.1% increase in the odds of being ‘Satisfied’. empcat: The odds ratio is 2.25050861, suggesting a strong positive relationship between this variable and the odds of being ‘Satisfied’.</p>
<p>Moving to predicting with this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>probability <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit.model, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(probability)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6 
0.37468715 0.36128037 0.05980003 0.33720941 0.46669672 0.12617525 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(probability <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 1  2  3  4  5  6 
No No No No No No 
Levels: No Yes</code></pre>
</div>
</div>
<p>Performance: confusion matrix</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No  584 125
       Yes  36  22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.7900913 0.1191015 </code></pre>
</div>
</div>
<p>Here in the prediction we actually see quite good behaviour even though the first model didn’t seem super amazing. The accuracy is quite high and there is a decent balance in the confusion matrix with very few false negatives and some more false positives.</p>
</section>
<section id="alternative-approach-to-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="alternative-approach-to-logistic-regression">Alternative approach to Logistic Regression</h2>
<p>Since there were odd variables proving to be significant, I will try the regression by reducing the variables according to my own knowledge and what I have seen in the past models and making some transformations to see if I can capture some possibly non-linear relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>logit.model2 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(Satisfied <span class="sc">~</span> empcat <span class="sc">+</span> car <span class="sc">+</span> income <span class="sc">+</span> employ <span class="sc">+</span> age <span class="sc">+</span> marital ,<span class="at">data =</span> training, <span class="at">family =</span> binomial)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Satisfied ~ empcat + car + income + employ + age + 
    marital, family = binomial, data = training)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.5482322  0.2819336 -12.585  &lt; 2e-16 ***
empcat       0.5602172  0.1307387   4.285 1.83e-05 ***
car          0.0004954  0.0002710   1.828   0.0675 .  
income       0.0002089  0.0007121   0.293   0.7693    
employ       0.0491455  0.0107459   4.573 4.80e-06 ***
age          0.0017244  0.0056177   0.307   0.7589    
marital      0.0528515  0.0994453   0.531   0.5951    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3008.9  on 3072  degrees of freedom
Residual deviance: 2577.5  on 3066  degrees of freedom
AIC: 2591.5

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>logit.model3 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(Satisfied <span class="sc">~</span> empcat <span class="sc">+</span> car <span class="sc">+</span> income <span class="sc">+</span> employ <span class="sc">+</span> age <span class="sc">+</span> marital <span class="sc">+</span> (car<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">log</span>(car) <span class="sc">+</span> (income<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">log</span>(income) <span class="sc">+</span> (employ<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">log</span>(age) ,<span class="at">data =</span> training, <span class="at">family =</span> binomial)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Satisfied ~ empcat + car + income + employ + age + 
    marital + (car^2) + log(car) + (income^2) + log(income) + 
    (employ^2) + (age^2) + log(age), family = binomial, data = training)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.295e+01  3.814e+00  -3.395 0.000686 ***
empcat       4.400e-01  1.373e-01   3.205 0.001350 ** 
car         -9.523e-05  5.231e-04  -0.182 0.855543    
income      -7.472e-05  1.056e-03  -0.071 0.943565    
employ       5.734e-02  1.127e-02   5.090 3.59e-07 ***
age         -7.103e-02  3.340e-02  -2.126 0.033468 *  
marital      4.680e-02  9.948e-02   0.470 0.638074    
log(car)     8.929e-02  1.088e-01   0.821 0.411654    
log(income)  6.808e-02  1.638e-01   0.416 0.677626    
log(age)     3.257e+00  1.453e+00   2.241 0.025029 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3008.9  on 3072  degrees of freedom
Residual deviance: 2569.2  on 3063  degrees of freedom
AIC: 2589.2

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>logit.model4 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(Satisfied <span class="sc">~</span>  car <span class="sc">+</span> income <span class="sc">+</span> employ <span class="sc">+</span> age <span class="sc">+</span> marital <span class="sc">+</span> (car<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">log</span>(car) <span class="sc">+</span> (income<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">log</span>(income) <span class="sc">+</span> (employ<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> (age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">log</span>(age) <span class="sc">+</span> <span class="fu">log</span>(empcat) ,<span class="at">data =</span> training, <span class="at">family =</span> binomial)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.model4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Satisfied ~ car + income + employ + age + marital + 
    (car^2) + log(car) + (income^2) + log(income) + (employ^2) + 
    (age^2) + log(age) + log(empcat), family = binomial, data = training)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.145e+01  3.899e+00  -2.935 0.003334 ** 
car         -2.485e-05  5.227e-04  -0.048 0.962082    
income       2.605e-05  1.055e-03   0.025 0.980306    
employ       5.569e-02  1.055e-02   5.278  1.3e-07 ***
age         -6.206e-02  3.379e-02  -1.837 0.066247 .  
marital      4.840e-02  9.942e-02   0.487 0.626418    
log(car)     7.866e-02  1.087e-01   0.724 0.469368    
log(income)  5.787e-02  1.637e-01   0.354 0.723682    
log(age)     2.854e+00  1.474e+00   1.937 0.052802 .  
log(empcat)  9.310e-01  2.449e-01   3.801 0.000144 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3008.9  on 3072  degrees of freedom
Residual deviance: 2564.6  on 3063  degrees of freedom
AIC: 2584.6

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>We see not much of a difference between the models that I tried here. In the first model I tried to rediuce the variables based on what past models have deemed important, however employment category was still the only significant variable.</p>
<p>Then to try to break this cycle I added transformations to many of the variables and then got some interesting variables that popped up and became significant. IN the last one I finally removed the empcat variable to see what would be significant (while also adding the log transformationt for empcat).</p>
<p>As a final improved model I will pick the significant variables from logit.model3 but only choosing one age variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>logit.model3 <span class="ot">&lt;-</span>  <span class="fu">glm</span>(Satisfied <span class="sc">~</span> empcat <span class="sc">+</span> employ <span class="sc">+</span> age ,<span class="at">data =</span> training, <span class="at">family =</span> binomial)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logit.model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Satisfied ~ empcat + employ + age, family = binomial, 
    data = training)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.4316910  0.2723928 -12.598  &lt; 2e-16 ***
empcat       0.5884961  0.1286545   4.574 4.78e-06 ***
employ       0.0558715  0.0099673   5.605 2.08e-08 ***
age          0.0001319  0.0055527   0.024    0.981    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3008.9  on 3072  degrees of freedom
Residual deviance: 2583.0  on 3069  degrees of freedom
AIC: 2591

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(logit.model3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      empcat      employ         age 
 0.03233222  1.80127740  1.05746183  1.00013193 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>probability <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit.model3, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(probability)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6 
0.39443258 0.34186948 0.05833832 0.30541026 0.50469545 0.14145698 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(probability <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  1   2   3   4   5   6 
 No  No  No  No Yes  No 
Levels: No Yes</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No  586 126
       Yes  34  21</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.7913950 0.1156208 </code></pre>
</div>
</div>
<p>Similarly to before, we see the effect of the change of 1 unit in the predictor in the log odds of someone being highly satisfied in their job. But now with less noise and more concentrated. However we see quite minimal effects on the variables that are not employment category.</p>
</section>
<section id="generalized-additive-models-gam" class="level2">
<h2 class="anchored" data-anchor-id="generalized-additive-models-gam">Generalized Additive Models (GAM)</h2>
<p>For a more flexible approach than logistic regression, we can use Generalized Additive Models (GAMs) to handle potential non-linear relationships between the predictors and the binary outcome. GAMs allow us to fit a non-linear function to each predictor, providing a more nuanced understanding of their effects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:lme4':

    lmList</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    collapse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is mgcv 1.8-42. For overview type 'help("mgcv-package")'.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting a GAM model</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>gam.model <span class="ot">&lt;-</span> <span class="fu">gam</span>(Satisfied <span class="sc">~</span> <span class="fu">factor</span>(empcat) <span class="sc">+</span> <span class="fu">s</span>(car) <span class="sc">+</span> <span class="fu">s</span>(income) <span class="sc">+</span> <span class="fu">s</span>(employ) <span class="sc">+</span> <span class="fu">s</span>(age) <span class="sc">+</span> <span class="fu">factor</span>(marital), </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> training, </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> binomial)</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gam.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: binomial 
Link function: logit 

Formula:
Satisfied ~ factor(empcat) + s(car) + s(income) + s(employ) + 
    s(age) + factor(marital)

Parametric coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      -1.44814    0.23847  -6.073 1.26e-09 ***
factor(empcat)2  -0.57780    0.33707  -1.714   0.0865 .  
factor(empcat)3  -0.73410    0.45080  -1.628   0.1034    
factor(marital)1  0.07159    0.09950   0.719   0.4718    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
            edf Ref.df Chi.sq p-value    
s(car)    1.000  1.000  2.629   0.105    
s(income) 1.000  1.000  0.526   0.468    
s(employ) 6.224  7.351 54.815  &lt;2e-16 ***
s(age)    1.000  1.001  0.013   0.912    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.147   Deviance explained = 15.8%
UBRE = -0.16727  Scale est. = 1         n = 3073</code></pre>
</div>
</div>
<p>The model suggests that empcat (employment category) and employ (employment duration) have some relationship with job satisfaction, with employ having a non-linear effect. The other predictors (car, income, age, marital) are included in the model, but their smooth terms don’t provide strong evidence of a non-linear relationship with the log odds of being Satisfied based on their p-values. The R^2 in this model is extremely low, so this model does not seem to be very efficient for us.</p>
<p>factor(empcat)2: The coefficient of -1.1027 means that being in the second category of the employment category variable is associated with a log odds decrease of 1.1027 for being ‘Satisfied’ compared to the reference category. In terms of odds ratios, you can exponentiate this coefficient to get the odds ratio: exp(-1.1027) ≈ 0.33. This means that the odds of being ‘Satisfied’ are about 67% lower for empcat2 compared to the reference group (assuming other variables are held constant).</p>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>rfFit <span class="ot">&lt;-</span> <span class="fu">train</span>(Satisfied <span class="sc">~</span> ., </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> training,</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method =</span> <span class="st">"rf"</span>,   </span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">preProc=</span><span class="fu">c</span>(<span class="st">'scale'</span>,<span class="st">'center'</span>),</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tuneLength =</span> <span class="dv">10</span>,</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">metric=</span><span class="st">"ROC"</span>,</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">trControl =</span> ctrl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1.Rep1: mtry= 2 
- Fold1.Rep1: mtry= 2 
+ Fold1.Rep1: mtry= 4 
- Fold1.Rep1: mtry= 4 
+ Fold1.Rep1: mtry= 7 
- Fold1.Rep1: mtry= 7 
+ Fold1.Rep1: mtry=10 
- Fold1.Rep1: mtry=10 
+ Fold1.Rep1: mtry=13 
- Fold1.Rep1: mtry=13 
+ Fold1.Rep1: mtry=15 
- Fold1.Rep1: mtry=15 
+ Fold1.Rep1: mtry=18 
- Fold1.Rep1: mtry=18 
+ Fold1.Rep1: mtry=21 
- Fold1.Rep1: mtry=21 
+ Fold1.Rep1: mtry=24 
- Fold1.Rep1: mtry=24 
+ Fold1.Rep1: mtry=27 
- Fold1.Rep1: mtry=27 
+ Fold2.Rep1: mtry= 2 
- Fold2.Rep1: mtry= 2 
+ Fold2.Rep1: mtry= 4 
- Fold2.Rep1: mtry= 4 
+ Fold2.Rep1: mtry= 7 
- Fold2.Rep1: mtry= 7 
+ Fold2.Rep1: mtry=10 
- Fold2.Rep1: mtry=10 
+ Fold2.Rep1: mtry=13 
- Fold2.Rep1: mtry=13 
+ Fold2.Rep1: mtry=15 
- Fold2.Rep1: mtry=15 
+ Fold2.Rep1: mtry=18 
- Fold2.Rep1: mtry=18 
+ Fold2.Rep1: mtry=21 
- Fold2.Rep1: mtry=21 
+ Fold2.Rep1: mtry=24 
- Fold2.Rep1: mtry=24 
+ Fold2.Rep1: mtry=27 
- Fold2.Rep1: mtry=27 
+ Fold3.Rep1: mtry= 2 
- Fold3.Rep1: mtry= 2 
+ Fold3.Rep1: mtry= 4 
- Fold3.Rep1: mtry= 4 
+ Fold3.Rep1: mtry= 7 
- Fold3.Rep1: mtry= 7 
+ Fold3.Rep1: mtry=10 
- Fold3.Rep1: mtry=10 
+ Fold3.Rep1: mtry=13 
- Fold3.Rep1: mtry=13 
+ Fold3.Rep1: mtry=15 
- Fold3.Rep1: mtry=15 
+ Fold3.Rep1: mtry=18 
- Fold3.Rep1: mtry=18 
+ Fold3.Rep1: mtry=21 
- Fold3.Rep1: mtry=21 
+ Fold3.Rep1: mtry=24 
- Fold3.Rep1: mtry=24 
+ Fold3.Rep1: mtry=27 
- Fold3.Rep1: mtry=27 
+ Fold4.Rep1: mtry= 2 
- Fold4.Rep1: mtry= 2 
+ Fold4.Rep1: mtry= 4 
- Fold4.Rep1: mtry= 4 
+ Fold4.Rep1: mtry= 7 
- Fold4.Rep1: mtry= 7 
+ Fold4.Rep1: mtry=10 
- Fold4.Rep1: mtry=10 
+ Fold4.Rep1: mtry=13 
- Fold4.Rep1: mtry=13 
+ Fold4.Rep1: mtry=15 
- Fold4.Rep1: mtry=15 
+ Fold4.Rep1: mtry=18 
- Fold4.Rep1: mtry=18 
+ Fold4.Rep1: mtry=21 
- Fold4.Rep1: mtry=21 
+ Fold4.Rep1: mtry=24 
- Fold4.Rep1: mtry=24 
+ Fold4.Rep1: mtry=27 
- Fold4.Rep1: mtry=27 
+ Fold5.Rep1: mtry= 2 
- Fold5.Rep1: mtry= 2 
+ Fold5.Rep1: mtry= 4 
- Fold5.Rep1: mtry= 4 
+ Fold5.Rep1: mtry= 7 
- Fold5.Rep1: mtry= 7 
+ Fold5.Rep1: mtry=10 
- Fold5.Rep1: mtry=10 
+ Fold5.Rep1: mtry=13 
- Fold5.Rep1: mtry=13 
+ Fold5.Rep1: mtry=15 
- Fold5.Rep1: mtry=15 
+ Fold5.Rep1: mtry=18 
- Fold5.Rep1: mtry=18 
+ Fold5.Rep1: mtry=21 
- Fold5.Rep1: mtry=21 
+ Fold5.Rep1: mtry=24 
- Fold5.Rep1: mtry=24 
+ Fold5.Rep1: mtry=27 
- Fold5.Rep1: mtry=27 
Aggregating results
Selecting tuning parameters
Fitting mtry = 2 on full training set</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rfFit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>rfProb <span class="ot">=</span> <span class="fu">predict</span>(rfFit, testing, <span class="at">type=</span><span class="st">"prob"</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(rfProb[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">0.2</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>))</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Reference
Prediction  No Yes
       No  462  63
       Yes 158  84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(prediction, testing<span class="sc">$</span>Satisfied)<span class="sc">$</span>overall[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.7118644 0.2539797 </code></pre>
</div>
</div>
<p>We see promising results with this model. Accuracy: About 69%, indicating the proportion of total correct predictions (both positives and negatives) among all predictions. Kappa: Around 0.21, a statistic that compares an observed accuracy with an expected accuracy (random chance). A Kappa value closer to 1 indicates strong agreement, while closer to 0 suggests agreement equivalent to random chance. However we still see 56 false negatives and 22 false positives in the predictions indicating a level of uncertainty, however these are some of the best rates we have seen the whole analysis!</p>
<p>Looking at the trend in the plot, it appears that the model’s performance (as measured by ROC) decreasesas the number of predictors increases. This could indicate that adding more predictors does not necessarily improve the model; in fact, it might introduce noise or irrelevant information, which could slightly degrade the model’s ability to discriminate between the classes. So it seems according to Random Forest model the optimal amount of predictors is 3 or 4.</p>
</section>
<section id="stepwise-forward-regression" class="level2">
<h2 class="anchored" data-anchor-id="stepwise-forward-regression">Stepwise forward regression</h2>
<p>Since I have a binary target variable, linear regressions wouldnt work for me most of the time, but this model should be useful as you can use Akaike Information Criterion (AIC) for a more balanced approach to model selection, considering both the goodness of fit and the simplicity of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the initial model with only the intercept (no predictors)</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>initial_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Satisfied <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>training, <span class="at">family=</span>binomial)</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the full model with all predictors</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Satisfied <span class="sc">~</span> ., <span class="at">data=</span>training, <span class="at">family=</span>binomial)</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform stepwise model selection based on AIC</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>stepwise_model <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(initial_model, <span class="at">scope=</span><span class="fu">list</span>(<span class="at">lower=</span>initial_model, <span class="at">upper=</span>full_model), </span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">direction=</span><span class="st">"forward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=3010.9
Satisfied ~ 1

             Df Deviance    AIC
+ employ      1   2604.0 2608.0
+ empcat      1   2621.3 2625.3
+ car         1   2830.3 2834.3
+ age         1   2843.8 2847.8
+ income      1   2854.2 2858.2
+ `filter_$`  1   2868.5 2872.5
+ address     1   2955.3 2959.3
+ news        1   2980.8 2984.8
+ ed          1   2987.6 2991.6
+ owncd       1   2992.1 2996.1
+ ownvcr      1   2994.2 2998.2
+ voice       1   2995.6 2999.6
+ pager       1   2996.1 3000.1
+ retire      1   2996.6 3000.6
+ reside      1   2997.5 3001.5
+ multline    1   2999.1 3003.1
+ owntv       1   2999.3 3003.3
+ gender      1   3005.3 3009.3
+ wireless    1   3005.4 3009.4
+ callwait    1   3005.8 3009.8
&lt;none&gt;            3008.9 3010.9
+ callid      1   3007.1 3011.1
+ ownpc       1   3007.8 3011.8
+ ownpda      1   3008.3 3012.3
+ internet    1   3008.4 3012.4
+ marital     1   3008.6 3012.6
+ ownfax      1   3008.8 3012.8
+ response    1   3008.9 3012.9

Step:  AIC=2607.96
Satisfied ~ employ

             Df Deviance    AIC
+ empcat      1   2583.1 2589.1
+ car         1   2596.6 2602.6
+ owntv       1   2599.9 2605.9
+ owncd       1   2600.9 2606.9
+ pager       1   2601.1 2607.1
+ ownpc       1   2601.7 2607.7
+ gender      1   2601.9 2607.9
+ wireless    1   2601.9 2607.9
&lt;none&gt;            2604.0 2608.0
+ retire      1   2602.1 2608.1
+ ownvcr      1   2602.4 2608.4
+ multline    1   2602.9 2608.9
+ income      1   2602.9 2608.9
+ `filter_$`  1   2603.1 2609.1
+ reside      1   2603.5 2609.5
+ news        1   2603.6 2609.6
+ marital     1   2603.6 2609.6
+ voice       1   2603.8 2609.8
+ callwait    1   2603.9 2609.9
+ age         1   2603.9 2609.9
+ callid      1   2603.9 2609.9
+ ownfax      1   2603.9 2609.9
+ ownpda      1   2603.9 2609.9
+ response    1   2603.9 2609.9
+ address     1   2603.9 2609.9
+ ed          1   2603.9 2609.9
+ internet    1   2603.9 2609.9

Step:  AIC=2589.05
Satisfied ~ employ + empcat

             Df Deviance    AIC
+ car         1   2577.9 2585.9
+ owntv       1   2579.8 2587.8
+ wireless    1   2580.3 2588.3
+ pager       1   2580.5 2588.5
+ owncd       1   2580.9 2588.9
&lt;none&gt;            2583.1 2589.1
+ income      1   2581.1 2589.1
+ gender      1   2581.1 2589.1
+ ownpc       1   2581.2 2589.2
+ `filter_$`  1   2581.7 2589.7
+ retire      1   2581.8 2589.8
+ ownvcr      1   2582.1 2590.1
+ multline    1   2582.1 2590.1
+ reside      1   2582.4 2590.4
+ news        1   2582.6 2590.6
+ marital     1   2582.8 2590.8
+ callwait    1   2582.9 2590.9
+ voice       1   2582.9 2590.9
+ response    1   2583.0 2591.0
+ ownfax      1   2583.0 2591.0
+ ownpda      1   2583.0 2591.0
+ internet    1   2583.0 2591.0
+ ed          1   2583.0 2591.0
+ callid      1   2583.1 2591.1
+ age         1   2583.1 2591.1
+ address     1   2583.1 2591.1

Step:  AIC=2585.92
Satisfied ~ employ + empcat + car

             Df Deviance    AIC
+ wireless    1   2574.2 2584.2
+ owntv       1   2575.0 2585.0
+ pager       1   2575.4 2585.4
+ gender      1   2575.9 2585.9
&lt;none&gt;            2577.9 2585.9
+ owncd       1   2576.3 2586.3
+ ownpc       1   2576.6 2586.6
+ multline    1   2577.2 2587.2
+ reside      1   2577.2 2587.2
+ ownvcr      1   2577.3 2587.3
+ news        1   2577.4 2587.4
+ ed          1   2577.5 2587.5
+ callwait    1   2577.6 2587.6
+ marital     1   2577.6 2587.6
+ voice       1   2577.7 2587.7
+ response    1   2577.8 2587.8
+ `filter_$`  1   2577.8 2587.8
+ age         1   2577.8 2587.8
+ income      1   2577.8 2587.8
+ callid      1   2577.9 2587.9
+ retire      1   2577.9 2587.9
+ internet    1   2577.9 2587.9
+ ownpda      1   2577.9 2587.9
+ address     1   2577.9 2587.9
+ ownfax      1   2577.9 2587.9

Step:  AIC=2584.19
Satisfied ~ employ + empcat + car + wireless

             Df Deviance    AIC
+ owntv       1   2571.2 2583.2
+ ownpc       1   2571.3 2583.3
+ gender      1   2572.1 2584.1
&lt;none&gt;            2574.2 2584.2
+ pager       1   2572.3 2584.3
+ owncd       1   2572.4 2584.4
+ multline    1   2572.5 2584.5
+ reside      1   2573.5 2585.5
+ ownvcr      1   2573.6 2585.6
+ news        1   2573.7 2585.7
+ ownfax      1   2573.7 2585.7
+ ownpda      1   2573.8 2585.8
+ marital     1   2573.9 2585.9
+ income      1   2574.0 2586.0
+ response    1   2574.1 2586.1
+ callid      1   2574.1 2586.1
+ age         1   2574.1 2586.1
+ voice       1   2574.1 2586.1
+ ed          1   2574.2 2586.2
+ `filter_$`  1   2574.2 2586.2
+ retire      1   2574.2 2586.2
+ address     1   2574.2 2586.2
+ callwait    1   2574.2 2586.2
+ internet    1   2574.2 2586.2

Step:  AIC=2583.2
Satisfied ~ employ + empcat + car + wireless + owntv

             Df Deviance    AIC
+ ownpc       1   2568.4 2582.4
+ pager       1   2569.2 2583.2
&lt;none&gt;            2571.2 2583.2
+ gender      1   2569.2 2583.2
+ multline    1   2569.7 2583.7
+ reside      1   2570.4 2584.4
+ owncd       1   2570.5 2584.5
+ news        1   2570.6 2584.6
+ ownfax      1   2570.7 2584.7
+ ownpda      1   2570.8 2584.8
+ marital     1   2571.0 2585.0
+ income      1   2571.0 2585.0
+ response    1   2571.1 2585.1
+ age         1   2571.1 2585.1
+ voice       1   2571.1 2585.1
+ callid      1   2571.1 2585.1
+ ed          1   2571.2 2585.2
+ ownvcr      1   2571.2 2585.2
+ `filter_$`  1   2571.2 2585.2
+ callwait    1   2571.2 2585.2
+ address     1   2571.2 2585.2
+ retire      1   2571.2 2585.2
+ internet    1   2571.2 2585.2

Step:  AIC=2582.44
Satisfied ~ employ + empcat + car + wireless + owntv + ownpc

             Df Deviance    AIC
&lt;none&gt;            2568.4 2582.4
+ gender      1   2566.5 2582.5
+ pager       1   2566.7 2582.7
+ multline    1   2567.5 2583.5
+ reside      1   2567.7 2583.7
+ owncd       1   2567.7 2583.7
+ news        1   2567.8 2583.8
+ ed          1   2568.0 2584.0
+ ownfax      1   2568.1 2584.1
+ marital     1   2568.2 2584.2
+ response    1   2568.2 2584.2
+ age         1   2568.3 2584.3
+ ownpda      1   2568.3 2584.3
+ callid      1   2568.3 2584.3
+ income      1   2568.3 2584.3
+ voice       1   2568.4 2584.4
+ `filter_$`  1   2568.4 2584.4
+ ownvcr      1   2568.4 2584.4
+ internet    1   2568.4 2584.4
+ address     1   2568.4 2584.4
+ callwait    1   2568.4 2584.4
+ retire      1   2568.4 2584.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the selected model</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stepwise_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Satisfied ~ employ + empcat + car + wireless + 
    owntv + ownpc, family = binomial, data = training)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -4.8720263  1.0518278  -4.632 3.62e-06 ***
employ       0.0517334  0.0095351   5.426 5.78e-08 ***
empcat       0.5560597  0.1294672   4.295 1.75e-05 ***
car          0.0005421  0.0002355   2.302   0.0213 *  
wireless    -0.2448023  0.1068876  -2.290   0.0220 *  
owntv        1.4310003  1.0410178   1.375   0.1693    
ownpc        0.1746741  0.1051861   1.661   0.0968 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3008.9  on 3072  degrees of freedom
Residual deviance: 2568.4  on 3066  degrees of freedom
AIC: 2582.4

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>In summary, this model suggests that empcat, income, and ownfax are significant predictors of being Satisfied, with empcat showing a particularly strong effect. Wireless has a negative association with the outcome, but this effect is not statistically significant at the conventional 0.05 level. The model’s AIC suggests it might have a good balance between fit and complexity, and the reduction in deviance from the null to the residual model indicates that the predictors are providing useful information beyond what the intercept alone could provide.</p>
</section>
<section id="neural-networks" class="level2">
<h2 class="anchored" data-anchor-id="neural-networks">Neural Networks</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)  <span class="co"># For neuralnet if not using caret's method</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nnet'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:mgcv':

    multinom</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the tuning grid</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>tuneGrid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">size =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),  <span class="co"># Number of units in the hidden layer</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">decay =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.001</span>))  <span class="co"># Weight decay parameters</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>nn_tune <span class="ot">&lt;-</span> <span class="fu">train</span>(Satisfied <span class="sc">~</span> ., </span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> training,</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"nnet"</span>,</span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">preProc =</span> <span class="fu">c</span>(<span class="st">'scale'</span>, <span class="st">'center'</span>),</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trControl =</span> ctrl,</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tuneGrid =</span> tuneGrid,</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">metric =</span> <span class="st">"ROC"</span>,</span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">trace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb163-14"><a href="#cb163-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">MaxNWts =</span> <span class="dv">10000</span>,</span>
<span id="cb163-15"><a href="#cb163-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">maxit =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+ Fold1.Rep1: size=4, decay=0.100 
- Fold1.Rep1: size=4, decay=0.100 
+ Fold1.Rep1: size=2, decay=0.100 
- Fold1.Rep1: size=2, decay=0.100 
+ Fold1.Rep1: size=4, decay=0.001 
- Fold1.Rep1: size=4, decay=0.001 
+ Fold1.Rep1: size=2, decay=0.001 
- Fold1.Rep1: size=2, decay=0.001 
+ Fold2.Rep1: size=4, decay=0.100 
- Fold2.Rep1: size=4, decay=0.100 
+ Fold2.Rep1: size=2, decay=0.100 
- Fold2.Rep1: size=2, decay=0.100 
+ Fold2.Rep1: size=4, decay=0.001 
- Fold2.Rep1: size=4, decay=0.001 
+ Fold2.Rep1: size=2, decay=0.001 
- Fold2.Rep1: size=2, decay=0.001 
+ Fold3.Rep1: size=4, decay=0.100 
- Fold3.Rep1: size=4, decay=0.100 
+ Fold3.Rep1: size=2, decay=0.100 
- Fold3.Rep1: size=2, decay=0.100 
+ Fold3.Rep1: size=4, decay=0.001 
- Fold3.Rep1: size=4, decay=0.001 
+ Fold3.Rep1: size=2, decay=0.001 
- Fold3.Rep1: size=2, decay=0.001 
+ Fold4.Rep1: size=4, decay=0.100 
- Fold4.Rep1: size=4, decay=0.100 
+ Fold4.Rep1: size=2, decay=0.100 
- Fold4.Rep1: size=2, decay=0.100 
+ Fold4.Rep1: size=4, decay=0.001 
- Fold4.Rep1: size=4, decay=0.001 
+ Fold4.Rep1: size=2, decay=0.001 
- Fold4.Rep1: size=2, decay=0.001 
+ Fold5.Rep1: size=4, decay=0.100 
- Fold5.Rep1: size=4, decay=0.100 
+ Fold5.Rep1: size=2, decay=0.100 
- Fold5.Rep1: size=2, decay=0.100 
+ Fold5.Rep1: size=4, decay=0.001 
- Fold5.Rep1: size=4, decay=0.001 
+ Fold5.Rep1: size=2, decay=0.001 
- Fold5.Rep1: size=2, decay=0.001 
Aggregating results
Selecting tuning parameters
Fitting size = 2, decay = 0.1 on full training set</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(nn_tune, testing)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(<span class="at">pred =</span> predicted,  <span class="at">obs =</span> testing<span class="sc">$</span>Satisfied)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Accuracy     Kappa 
0.7705346 0.1387411 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(nn_tune, <span class="at">scale =</span> F), <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="at">cex =</span> .<span class="dv">95</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partial</span>(nn_tune, <span class="at">pred.var =</span> <span class="st">"empcat"</span>, <span class="at">plot =</span> <span class="cn">TRUE</span>, <span class="at">rug =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="finalassignment_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see with this model very odd results, however with a quite good accuracy, 0.8! However the variables chosen as the most important are odd and don’t seem to make much sense (such as having your own computer). In summary, the neural network model with 2 hidden units and a decay parameter of 0.1 is performing well on the testing set with an accuracy of 80%. However, interpreting variable importance and effects in neural networks requires caution and a good understanding of the model’s limitations.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>To conclude, I didn’t find a model in either methodology that was very very strong in predicting job satisfaction. The strongest model found was the model trained with the RDA method in the classification models. This model provided quite a strong accuracy however the sensitivity, so the true positive rate was almost perfect (0.89), however the specificity the true negative rate was much lower at 0.33. So ultimately we see that this model over predicts positive values in the prediction for job satisfaction.</p>
<p>In the regression models the logistic regression model was strong, and reducing the amount of variables and including some transformations helped in increasing the accuracy a little bit but not exponentially, so I would prefer the original logistic regression model or the 3rd model in order to not lose valuable information. However, there are quite strong competitors as the neural networks model also had a quite high accuracy of 80%, and so did the stepwise forward regression. However both have very similar levels when comparing other metrics, so the decision between the logistic regression, neural network model and stepwise forward regression is difficult.</p>
<p>Since in this case the interpretability is key and the performance is satisfactory, logistic regression or stepwise regression could be preferred, since the neural network is generally considered a “black box” model, meaning it’s difficult to interpret the impact of individual predictors on the outcome. In comparison then since the logistic regression is made for binary target variables I will choose this as the final model.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>